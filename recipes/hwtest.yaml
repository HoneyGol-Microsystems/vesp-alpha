metadata:
  type: "makepy recipe"
  version: 0.1

recipe:
  name: "Hardware Test"
  comment: "This test recipe compiles and runs Verilog test files using iverilog."
  sources:
    - path: "tests/hwtests"
      type: "verilog"
      
  # halt_on_step_error: true
  # halt_on_source_error
  steps:
    - make_directory:
        name: "build"
    - run:
        executable: "iverilog"
        params:
          - mpysource
          - "-obuild/tmp.out"
        assert:
          return_code: 0
          output:
            not_contains:
              - "ERROR"
    - run:
        executable: "build/tmp.out"
        assert:
          output:
            contains:
              - "ASSERT_SUCCESS"
            not_contains:
              - "ASSERT_FAIL"